<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml">
		<head>
			<!-- template designed by Marco Von Ballmoos  -->
			<title>SimpleTest</title>
			<link rel="stylesheet" href="../media/stylesheet.css" />
						<script src="../media/lib/classTree.js"></script>
												<script language="javascript" type="text/javascript">
				var imgPlus = new Image();
				var imgMinus = new Image();
				imgPlus.src = "../media/images/plus.png";
				imgMinus.src = "../media/images/minus.png";
				
				function showNode(Node){
							switch(navigator.family){
								case 'nn4':
									// Nav 4.x code fork...
							var oTable = document.layers["span" + Node];
							var oImg = document.layers["img" + Node];
									break;
								case 'ie4':
									// IE 4/5 code fork...
							var oTable = document.all["span" + Node];
							var oImg = document.all["img" + Node];
									break;
								case 'gecko':
									// Standards Compliant code fork...
							var oTable = document.getElementById("span" + Node);
							var oImg = document.getElementById("img" + Node);
									break;
							}
					oImg.src = imgMinus.src;
					oTable.style.display = "block";
				}
				
				function hideNode(Node){
							switch(navigator.family){
								case 'nn4':
									// Nav 4.x code fork...
							var oTable = document.layers["span" + Node];
							var oImg = document.layers["img" + Node];
									break;
								case 'ie4':
									// IE 4/5 code fork...
							var oTable = document.all["span" + Node];
							var oImg = document.all["img" + Node];
									break;
								case 'gecko':
									// Standards Compliant code fork...
							var oTable = document.getElementById("span" + Node);
							var oImg = document.getElementById("img" + Node);
									break;
							}
					oImg.src = imgPlus.src;
					oTable.style.display = "none";
				}
				
				function nodeIsVisible(Node){
							switch(navigator.family){
								case 'nn4':
									// Nav 4.x code fork...
							var oTable = document.layers["span" + Node];
									break;
								case 'ie4':
									// IE 4/5 code fork...
							var oTable = document.all["span" + Node];
									break;
								case 'gecko':
									// Standards Compliant code fork...
							var oTable = document.getElementById("span" + Node);
									break;
							}
					return (oTable && oTable.style.display == "block");
				}
				
				function toggleNodeVisibility(Node){
					if (nodeIsVisible(Node)){
						hideNode(Node);
					}else{
						showNode(Node);
					}
				}
			</script>
					</head>
		<body>
			<div class="page-body">			
	<table class="tutorial-nav-box">
	<tr>
		<td style="width: 30%">
							<a href="../SimpleTest/tutorial_Browser.pkg.html" class="nav-button">Previous</a>
					</td>
		<td style="text-align: center">
					</td>
		<td style="text-align: right; width: 30%">
							<span class="nav-button-disabled">Next</span>
					</td>
	</tr>
	<tr>
		<td style="width: 30%">
							<span class="detail">Scriptable browser</span>
					</td>
		<td style="text-align: center">
					</td>
		<td style="text-align: right; width: 30%">
					</td>
	</tr>
</table>
	
<div><a name=""></a><div class="ref-title-box"><h1 class="ref-title">SimpleTest</h1>
<h2 class="ref-purpose">The following assumes that you are familiar with the concept
                of unit testing as well as the PHP web development language.
                It is a guide for the impatient new user of
                <a href="https://sourceforge.net/project/showfiles.php?group_id=76550">SimpleTest</a>.
                For fuller documentation, especially if you are new
                to unit testing see the ongoing
                documentation.html, and for
                example test cases see the
                <a href="http://www.lastcraft.com/first_test_tutorial.php">unit testing tutorial</a>.</h2></div>
            <h1 class="title">Table of Contents</h1>
<ul class="toc">
	
			
					<li><a href="../SimpleTest/tutorial_QuickStart.pkg.html#unit">Using the tester quickly</a></li>
					
					<li><a href="../SimpleTest/tutorial_QuickStart.pkg.html#group">Building test suites</a></li>
					
					<li><a href="../SimpleTest/tutorial_QuickStart.pkg.html#mock">Using mock objects</a></li>
					
					<li><a href="../SimpleTest/tutorial_QuickStart.pkg.html#web">Web page testing</a></li>
					</ul>

            
        
        
        <span><a name="unit"></a><h2 class="title">Using the tester quickly</h2><p>Amongst software testing tools, a unit tester is the one
                closest to the developer.
                In the context of agile development the test code sits right
                next to the source code as both are written simultaneously.
                In this context SimpleTest aims to be a complete PHP developer
                test solution and is called &quot;Simple&quot; because it
                should be easy to use and extend.
                It wasn't a good choice of name really.
                It includes all of the typical functions you would expect from
                <a href="http://www.junit.org/">JUnit</a> and the
                <a href="http://sourceforge.net/projects/phpunit/">PHPUnit</a>
                ports, and includes
                <a href="http://www.mockobjects.com">mock objects</a>.</p>
            <p>What makes this tool immediately useful to the PHP developer is the internal
                web browser.
                This allows tests that navigate web sites, fill in forms and test pages.
                Being able to write these test in PHP means that it is easy to write
                integrated tests.
                An example might be confirming that a user was written to a database
                after a signing up through the web site.</p>
            <p>The quickest way to demonstrate SimpleTest is with an example.</p>
            <p>Let us suppose we are testing a simple file logging class called
                Log in classes/log.php.
                We start by creating a test script which we will call
                tests/log_test.php and populate it as follows...
<div class="src-code"><ol><li><div class="src-line"><span class="src-php">&lt;?php</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/autorun.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'../classes/log.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">TestOfLogging&nbsp;</span><span class="src-key">extends&nbsp;</span><a href="../SimpleTest/UnitTester/UnitTestCase.html">UnitTestCase</a>&nbsp;<span class="src-sym">{</span></div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-php">?&gt;</span></div></li>
</ol></div>
                Here the simpletest folder is either local or in the path.
                You would have to edit these locations depending on where you
                unpacked the toolset.
                The &quot;autorun.php&quot; file does more than just include the
                SimpleTest files, it also runs our test for us.</p>
            <p>The TestOfLogging is our first test case and it's
                currently empty.
                Each test case is a class that extends one of the SimpleTet base classes
                and we can have as many of these in the file as we want.</p>
            <p>With three lines of scaffolding, and our Log class
                include, we have a test suite.
                No tests though.</p>
            <p>For our first test, we'll assume that the Log class
                takes the file name to write to in the constructor, and we have
                a temporary folder in which to place this file...
<div class="src-code"><ol><li><div class="src-line"><span class="src-php">&lt;?php</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/autorun.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'../classes/log.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">TestOfLogging&nbsp;</span><span class="src-key">extends&nbsp;</span><a href="../SimpleTest/UnitTester/UnitTestCase.html">UnitTestCase</a>&nbsp;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">testLogCreatesNewFileOnFirstMessage</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">@</span><a href="http://www.php.net/unlink">unlink</a><span class="src-sym">(</span><span class="src-str">'/temp/test.log'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$log&nbsp;</span>=&nbsp;<span class="src-key">new&nbsp;</span><span class="src-id">Log</span><span class="src-sym">(</span><span class="src-str">'/temp/test.log'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">assertFalse</span><span class="src-sym">(</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-str">'/temp/test.log'</span><span class="src-sym">))</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$log</span><span class="src-sym">-&gt;</span><span class="src-id">message</span><span class="src-sym">(</span><span class="src-str">'Should&nbsp;write&nbsp;this&nbsp;to&nbsp;a&nbsp;file'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">assertTrue</span><span class="src-sym">(</span><a href="http://www.php.net/file_exists">file_exists</a><span class="src-sym">(</span><span class="src-str">'/temp/test.log'</span><span class="src-sym">))</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-php">?&gt;</span></div></li>
</ol></div>
                When a test case runs, it will search for any method that
                starts with the string &quot;test&quot;
                and execute that method.
                If the method starts &quot;test&quot;, it's a test.
                Note the very long name testLogCreatesNewFileOnFirstMessage().
                This is considered good style and makes the test output more readable.</p>
            <p>We would normally have more than one test method in a test case,
                but that's for later.</p>
            <p>Assertions within the test methods trigger messages to the
                test framework which displays the result immediately.
                This immediate response is important, not just in the event
                of the code causing a crash, but also so that
                print statements can display
                their debugging content right next to the assertion concerned.</p>
            <p>To see these results we have to actually run the tests.
                No other code is necessary - we can just open the page
                with our browser.</p>
            <p>On failure the display looks like this...
                TestOfLogging
                    Fail: testLogCreatesNewFileOnFirstMessage-&gt;True assertion failed.
                    1/1 test cases complete.
                    1 passes and 1 fails.
                ...and if it passes like this...
                TestOfLogging
                    1/1 test cases complete.
                    2 passes and 0 fails.
                And if you get this...
                Fatal error:  Failed opening required '../classes/log.php' (include_path='') in /home/marcus/projects/lastcraft/tutorial_tests/Log/tests/log_test.php on line 7
                it means you're missing the classes/Log.php file that could look like...
<div class="src-code"><ol><li><div class="src-line"><span class="src-php">&lt;?php</span></div></li>
<li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">Log&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">Log</span><span class="src-sym">(</span><span class="src-var">$file_path</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">message</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-php">?&gt;</span></div></li>
</ol></div>
                It's fun to write the code after the test.
                More than fun even -
                this system is called &quot;Test Driven Development&quot;.</p>
            <p>For more information about UnitTestCase, see
                the unit.</p></span>
        <span><a name="group"></a><h2 class="title">Building test suites</h2><p>It is unlikely in a real application that we will only ever run
                one test case.
                This means that we need a way of grouping cases into a test
                script that can, if need be, run every test for the application.</p>
            <p>Our first step is to create a new file called tests/all_tests.php
                and insert the following code...
<div class="src-code"><ol><li><div class="src-line"><span class="src-php">&lt;?php</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/autorun.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">AllTests&nbsp;</span><span class="src-key">extends&nbsp;</span><a href="../SimpleTest/UnitTester/TestSuite.html">TestSuite</a>&nbsp;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">AllTests</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">TestSuite</span><span class="src-sym">(</span><span class="src-str">'All&nbsp;tests'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">addFile</span><span class="src-sym">(</span><span class="src-str">'log_test.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-php">?&gt;</span></div></li>
</ol></div>
                The &quot;autorun&quot; include allows our upcoming test suite
                to be run just by invoking this script.</p>
            <p>The TestSuite subclass must chain it's constructor.
                This limitation will be removed in future versions.</p>
            <p>The method TestSuite::addFile()
                will include the test case file and read any new classes
                that are descended from SimpleTestCase.
                UnitTestCase is just one example of a class derived from
                SimpleTestCase, and you can create your own.
                TestSuite::addFile() can include other test suites.</p>
            <p>The class will not be instantiated yet.
                When the test suite runs it will construct each instance once
                it reaches that test, then destroy it straight after.
                This means that the constructor is run just before each run
                of that test case, and the destructor is run before the next test case starts.</p>
            <p>It is common to group test case code into superclasses which are not
                supposed to run, but become the base classes of other tests.
                For &quot;autorun&quot; to work properly the test case file should not blindly run
                any other test case extensions that do not actually run tests.
                This could result in extra test cases being counted during the test
                run.
                Hardly a major problem, but to avoid this inconvenience simply mark your
                base class as abstract.
                SimpleTest won't run abstract classes.
                If you are still using PHP4, then
                a SimpleTestOptions::ignore() directive
                somewhere in the test case file will have the same effect.</p>
            <p>Also, the test case file should not have been included
                elsewhere or no cases will be added to this group test.
                This would be a more serious error as if the test case classes are
                already loaded by PHP the TestSuite::addFile()
                method will not detect them.</p>
            <p>To display the results it is necessary only to invoke
                tests/all_tests.php from the web server or the command line.</p>
            <p>For more information about building test suites,
                see the test.</p></span>
        <span><a name="mock"></a><h2 class="title">Using mock objects</h2><p>Let's move further into the future and do something really complicated.</p>
            <p>Assume that our logging class is tested and completed.
                Assume also that we are testing another class that is
                required to write log messages, say a
                SessionPool.
                We want to test a method that will probably end up looking
                like this...
<div class="src-code"><ol><li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">SessionPool&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;...</div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">logIn</span><span class="src-sym">(</span><span class="src-var">$username</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-var">_log</span><span class="src-sym">-&gt;</span><span class="src-id">message</span><span class="src-sym">(</span><span class="src-str">&quot;</span><span class="src-str">User&nbsp;<span class="src-var">$username</span>&nbsp;logged&nbsp;in.</span><span class="src-str">&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;...</div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
</ol></div>
                In the spirit of reuse, we are using our
                Log class.
                A conventional test case might look like this...
<div class="src-code"><ol><li><div class="src-line"><span class="src-php">&lt;?php</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/autorun.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'../classes/log.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'../classes/session_pool.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">TestOfSessionLogging&nbsp;</span><span class="src-key">extends&nbsp;</span><a href="../SimpleTest/UnitTester/UnitTestCase.html">UnitTestCase</a>&nbsp;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;</div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">setUp</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">@</span><a href="http://www.php.net/unlink">unlink</a><span class="src-sym">(</span><span class="src-str">'/temp/test.log'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;</div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">tearDown</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">@</span><a href="http://www.php.net/unlink">unlink</a><span class="src-sym">(</span><span class="src-str">'/temp/test.log'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;</div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">testLoggingInIsLogged</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$log&nbsp;</span>=&nbsp;<span class="src-key">new&nbsp;</span><span class="src-id">Log</span><span class="src-sym">(</span><span class="src-str">'/temp/test.log'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$session_pool&nbsp;</span>=&nbsp;<span class="src-sym">&amp;</span><span class="src-key">new&nbsp;</span><span class="src-id">SessionPool</span><span class="src-sym">(</span><span class="src-var">$log</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$session_pool</span><span class="src-sym">-&gt;</span><span class="src-id">logIn</span><span class="src-sym">(</span><span class="src-str">'fred'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$messages&nbsp;</span>=&nbsp;<a href="http://www.php.net/file">file</a><span class="src-sym">(</span><span class="src-str">'/temp/test.log'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">assertEqual</span><span class="src-sym">(</span><span class="src-var">$messages</span><span class="src-sym">[</span><span class="src-num">0</span><span class="src-sym">]</span><span class="src-sym">,&nbsp;</span><span class="src-str">&quot;User&nbsp;fred&nbsp;logged&nbsp;in.\n&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-php">?&gt;</span></div></li>
</ol></div>
                We'll explain the setUp() and tearDown()
                methods later.</p>
            <p>This test case design is not all bad, but it could be improved.
                We are spending time fiddling with log files which are
                not part of our test.
                We have created close ties with the Log class and
                this test.
                What if we don't use files any more, but use ths
                syslog library instead?
                It means that our TestOfSessionLogging test will
                fail, even thouh it's not testing Logging.</p>
            <p>It's fragile in smaller ways too.
                Did you notice the extra carriage return in the message?
                Was that added by the logger?
                What if it also added a time stamp or other data?</p>
            <p>The only part that we really want to test is that a particular
                message was sent to the logger.
                We can reduce coupling if we pass in a fake logging class
                that simply records the message calls for testing, but
                takes no action.
                It would have to look exactly like our original though.</p>
            <p>If the fake object doesn't write to a file then we save on deleting
                the file before and after each test. We could save even more
                test code if the fake object would kindly run the assertion for us.
            <p></p>
                Too good to be true?
                We can create such an object easily...
<div class="src-code"><ol><li><div class="src-line"><span class="src-php">&lt;?php</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/autorun.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'../classes/log.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'../classes/session_pool.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line"><span class="src-id"><a href="../SimpleTest/MockObjects/Mock.html">Mock</a></span><span class="src-sym">::</span><a href="../SimpleTest/MockObjects/Mock.html#methodgenerate">generate</a><span class="src-sym">(</span><span class="src-str">'Log'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">TestOfSessionLogging&nbsp;</span><span class="src-key">extends&nbsp;</span><a href="../SimpleTest/UnitTester/UnitTestCase.html">UnitTestCase</a>&nbsp;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;</div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">testLoggingInIsLogged</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$log&nbsp;</span>=&nbsp;<span class="src-sym">&amp;</span><span class="src-key">new&nbsp;</span><span class="src-id">MockLog</span><span class="src-sym">(</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$log</span><span class="src-sym">-&gt;</span><span class="src-id">expectOnce</span><span class="src-sym">(</span><span class="src-str">'message'</span><span class="src-sym">,&nbsp;</span><span class="src-key">array</span><span class="src-sym">(</span><span class="src-str">'User&nbsp;fred&nbsp;logged&nbsp;in.'</span><span class="src-sym">))</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$session_pool&nbsp;</span>=&nbsp;<span class="src-sym">&amp;</span><span class="src-key">new&nbsp;</span><span class="src-id">SessionPool</span><span class="src-sym">(</span><span class="src-var">$log</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$session_pool</span><span class="src-sym">-&gt;</span><span class="src-id">logIn</span><span class="src-sym">(</span><span class="src-str">'fred'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-php">?&gt;</span></div></li>
</ol></div>
                The Mock::generate() call code generated a new class
                called MockLog.
                This looks like an identical clone, except that we can wire test code
                to it.
                That's what expectOnce() does.
                It says that if message() is ever called on me, it had
                better be with the parameter &quot;User fred logged in.&quot;.</p>
            <p>The test will be triggered when the call to
                message() is invoked on the
                MockLog object by SessionPool::logIn() code.
                The mock call will trigger a parameter comparison and then send the
                resulting pass or fail event to the test display.
                Wildcards can be included here too, so you don't have to test every parameter of
                a call when you only want to test one.</p>
            <p>If the mock reaches the end of the test case without the
                method being called, the expectOnce()
                expectation will trigger a test failure.
                In other words the mocks can detect the absence of
                behaviour as well as the presence.</p>
            <p>The mock objects in the SimpleTest suite can have arbitrary
                return values set, sequences of returns, return values
                selected according to the incoming arguments, sequences of
                parameter expectations and limits on the number of times
                a method is to be invoked.</p>
            <p>For more information about mocking and stubbing, see the
                mock.</p></span>
        <span><a name="web"></a><h2 class="title">Web page testing</h2><p>One of the requirements of web sites is that they produce web
                pages.
                If you are building a project top-down and you want to fully
                integrate testing along the way then you will want a way of
                automatically navigating a site and examining output for
                correctness.
                This is the job of a web tester.</p>
            <p>The web testing in SimpleTest is fairly primitive, as there is
                no JavaScript.
                Most other browser operations are simulated.</p>
            <p>To give an idea here is a trivial example where a home
                page is fetched, from which we navigate to an &quot;about&quot;
                page and then test some client determined content.
<div class="src-code"><ol><li><div class="src-line"><span class="src-php">&lt;?php</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/autorun.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/web_tester.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">TestOfAbout&nbsp;</span><span class="src-key">extends&nbsp;</span><a href="../SimpleTest/WebTester/WebTestCase.html">WebTestCase</a>&nbsp;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">testOurAboutPageGivesFreeReignToOurEgo</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">get</span><span class="src-sym">(</span><span class="src-str">'http://test-server/index.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">click</span><span class="src-sym">(</span><span class="src-str">'About'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">assertTitle</span><span class="src-sym">(</span><span class="src-str">'About&nbsp;why&nbsp;we&nbsp;are&nbsp;so&nbsp;great'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">assertText</span><span class="src-sym">(</span><span class="src-str">'We&nbsp;are&nbsp;really&nbsp;great'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-php">?&gt;</span></div></li>
</ol></div>
                With this code as an acceptance test, you can ensure that
                the content always meets the specifications of both the
                developers, and the other project stakeholders.</p>
            <p>You can navigate forms too...
<div class="src-code"><ol><li><div class="src-line"><span class="src-php">&lt;?php</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/autorun.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line"><span class="src-inc">require_once</span><span class="src-sym">(</span><span class="src-str">'simpletest/web_tester.php'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;</div></li>
<li><div class="src-line"><span class="src-key">class&nbsp;</span><span class="src-id">TestOfRankings&nbsp;</span><span class="src-key">extends&nbsp;</span><a href="../SimpleTest/WebTester/WebTestCase.html">WebTestCase</a>&nbsp;<span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-key">function&nbsp;</span><span class="src-id">testWeAreTopOfGoogle</span><span class="src-sym">(</span><span class="src-sym">)&nbsp;</span><span class="src-sym">{</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">get</span><span class="src-sym">(</span><span class="src-str">'http://google.com/'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">setField</span><span class="src-sym">(</span><span class="src-str">'q'</span><span class="src-sym">,&nbsp;</span><span class="src-str">'simpletest'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">click</span><span class="src-sym">(</span><span class="src-str">&quot;I'm&nbsp;Feeling&nbsp;Lucky&quot;</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-var">$this</span><span class="src-sym">-&gt;</span><span class="src-id">assertTitle</span><span class="src-sym">(</span><span class="src-str">'SimpleTest&nbsp;-&nbsp;Unit&nbsp;Testing&nbsp;for&nbsp;PHP'</span><span class="src-sym">)</span><span class="src-sym">;</span></div></li>
<li><div class="src-line">&nbsp;&nbsp;&nbsp;&nbsp;<span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-sym">}</span></div></li>
<li><div class="src-line"><span class="src-php">?&gt;</span></div></li>
</ol></div>
                ...although this could violate Google's(tm) terms and conditions.</p>
            <p>For more information about web testing, see the
                scriptable and the
                WebTestCase.html.</p>
            <p><a href="http://sourceforge.net/projects/simpletest/">&lt;img src=&quot;http://sourceforge.net/sflogo.php?group_id=76550&amp;amp;type=5&quot; width=&quot;210&quot; height=&quot;62&quot; border=&quot;0&quot; alt=&quot;SourceForge.net Logo&quot;/&gt;</a></p></span></div>

	<table class="tutorial-nav-box">
	<tr>
		<td style="width: 30%">
							<a href="../SimpleTest/tutorial_Browser.pkg.html" class="nav-button">Previous</a>
					</td>
		<td style="text-align: center">
					</td>
		<td style="text-align: right; width: 30%">
							<span class="nav-button-disabled">Next</span>
					</td>
	</tr>
	<tr>
		<td style="width: 30%">
							<span class="detail">Scriptable browser</span>
					</td>
		<td style="text-align: center">
					</td>
		<td style="text-align: right; width: 30%">
					</td>
	</tr>
</table>
	
	<p class="notes" id="credit">
		Documentation generated on Fri, 20 Jan 2012 01:58:43 +0100 by <a href="http://www.phpdoc.org" target="_blank">phpDocumentor 1.4.3</a>
	</p>
	</div></body>
</html>